{{ define "title"}}Overpower Play Game Page{{end}}
{{ define "css"}}overpower{{end}}
{{define "body"}}
{{ $g := .game }}
{{ $f := .fac }}
{{ $fNames := .fNames }}
{{ $center := .mapview.Center }}
{{ $pidPV := .pidPV }}
{{ $svDest := .svDest }}
{{ $svLoc := .svLoc }}

<div class="mapbox">
<form id="mapform" action="" method="post" class="noblock">
<input type="hidden" name="turn" value="{{ $g.Turn }}">
<input type="hidden" name="action" value="mapclick">
</form>
<img id="map" class="map" src="/overpower/img/{{ $g.Gid }}" width=800 height=600 />

<b>Game:</b> [ <a href="/overpower/view/{{ $g.Gid }}">{{ $g.Name }}</a> ] &bull; <b>Faction:</b> {{ $f.Name }} &bull; <b>Turn:</b> {{ $g.Turn }} 
{{ if not $f.Done }}
(In Progress)
<form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setdone">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="hidden" name="done" value="true">
        <input type="submit" value="Set Turn Complete" class="noblock">
</form>
{{ else }}
(Complete)
<form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setdone">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="hidden" name="done" value="false">
        <input type="submit" value="Cancel Turn Complete" class="noblock">
</form>
{{ end }}
<br>
<b>Reports:</b>
{{ if .reportlen }}
[ <a href="/overpower/view/{{ $g.Gid }}/reports/{{ .prevturn }}">{{ .reportlen }} Report{{ if not (eq .reportlen 1) }}s{{end}} for turn {{ .prevturn }}</a> ]
{{ else }}
{{ if .prevturn }}
[ <a href="/overpower/view/{{ $g.Gid }}/reports/{{ .prevturn }}">No reports for turn {{ .prevturn }}</a> ]
{{ else }}
[ No reports yet generated ]
{{ end }}
{{ end }}
<hr>
Map Centered on ({{ index $center 0}}, {{ index $center 1 }}):
{{  if .centerpv }}{{ .centerpv.Name }}{{ else }}The Great Void{{ end }}<br>
Zoom {{ .mapview.Zoom }} {{ if .zoomin }}
<form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setmap">
        <input type="hidden" name="subtype" value="zoom">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="hidden" name="zoom" value="{{ .zoomin }}">
        <input type="submit" value="Zoom In" class="noblock">
</form>
{{ end }}

{{ if .zoomout }}
<form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setmap">
        <input type="hidden" name="subtype" value="zoom">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="hidden" name="zoom" value="{{ .zoomout }}">
        <input type="submit" value="Zoom Out" class="noblock">
</form>
{{ end }}
 {{ if .bigzoomin }}
<form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setmap">
        <input type="hidden" name="subtype" value="zoom">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="hidden" name="zoom" value="{{ .bigzoomin }}">
        <input type="submit" value="Big Zoom In" class="noblock">
</form>
{{ end }}
{{ if .bigzoomout }}
<form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setmap">
        <input type="hidden" name="subtype" value="zoom">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="hidden" name="zoom" value="{{ .bigzoomout }}">
        <input type="submit" value="Big Zoom Out" class="noblock">
</form>
{{ end }}
<hr>

<div class="targetframe">
<div class="rightframe">
        <div class="center">
        <b>Secondary Target:</b> {{ if .target2.Valid }}
        {{ if .targetsSame }} ({{ index .target2.Coord 0 }}, {{ index .target2.Coord 1 }})<br> (Same as main target)</div> {{ else }}
        ({{ index .target2.Coord 0 }}, {{ index .target2.Coord 1 }})<br>
{{ if .cancenter2 }}
[ <a href="{{ command "recenter"}}/{{ index .target2.Coord 0 }}/{{ index .target2.Coord 1 }}">Center map here</a> ]<br>
{{ end }}
        </div>
        {{ if .tar2pv }}
        {{ $pl := .tar2pv }}
        {{ $other := .tar1pv }}
        {{ $yours := eq $pl.Controller $f.Fid }}
        <hr class="target">
        {{ $pl.Name }}<br>
        {{ if not $pl.Turn }} No planetary information available.<br> {{ else }}
        {{ if not $yours }}
        Hostile planet: {{ index $fNames $pl.Controller }}<br>
        Last seen on turn {{ $pl.Turn }}<br>
        Inhabitants: {{ $pl.Inhabitants }} &bull; Resources: {{ $pl.Resources }}<br>
        Ship parts: {{ $pl.Parts }}<br>


        {{ else }}
        {{ $avail := index .availMap $pl.Pid }}
        Your planet<br>
        Inhabitants: {{ $pl.Inhabitants }} &bull; Resources: {{ $pl.Resources }}<br>
        Ship parts: {{ $pl.Parts }} ({{ $avail }} available)<br>

        {{ if $other }} {{ if .t2t1ord }}
        <hr class="target">
        You have {{ $other.Name }} as your main target and are launching a ship sized {{ .t2t1ord.Size }} at it.  Change this launch order?<br>
        <form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setorder">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="hidden" name="source" value="{{ $pl.Pid }}">
        <input type="hidden" name="target" value="{{ $other.Pid }}">
        &bull; <input type="text" size=2 name="size">
        <input type="submit" value="Change size" class="noblock"> (0 to cancel)
        </form>
       
        {{ else if $avail }}
        <hr class="target">
        You have {{ $other.Name }} as your main target (distance {{ .tarDist }}) and have {{ $avail }} ship parts available to launch a ship at it.  <br>
        Order a launch? &bull;
        <form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setorder">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="hidden" name="source" value="{{ $pl.Pid }}">
        <input type="hidden" name="target" value="{{ $other.Pid }}">
        Ship size: <input type="text" size=2 name="size"><br>
        <input type="submit" value="Order launch at {{ $other.Name }}" class="noblock">
        </form>
        {{ end }} {{ end }}
        
        {{ if .t2ords }}
        <hr class="target">
        {{ if .t2t1ord }}Other {{end}}Planetary launch orders:<br>
        {{ range .t2ords }}
        {{ $pv := index $pidPV .Target }}
        {{ $loc := $pv.Loc }}
        {{ if ne $loc.String $center.String }}
        Ship size {{ .Size }} at [ <a href="{{ command "recenter" }}/{{ index $loc 0}}/{{ index $loc 1 }}">{{ $pv.Name }}</a> ] <br>
        {{ else }}
        Ship size {{ .Size }} at [ {{ $pv.Name }} ] <br>
        {{ end }}
        &bull;  <form action="" method="post" class="noblock">
                <input type="hidden" name="action" value="setorder">
                <input type="hidden" name="turn" value="{{ $g.Turn }}">
                <input type="hidden" name="source" value="{{ .Source }}">
                <input type="hidden" name="target" value="{{ .Target }}">
                <input type="text" size=2 name="size">
                <input type="submit" value="Change size" class="noblock"> (0 to cancel)
                </form>
       
        {{ end }}
        {{ else }}
        <hr class="target">
        You have no {{ if .t2t1ord }}other {{ end }}launch orders from {{ $pl.Name }}.<br>
        {{ end }}
        
        {{ end }} {{ end }}{{ end }}
        

        {{ end }} {{ else }} 
        None<br>
        </div>
        {{ end }}


{{ if .svAt2 }}
<hr class="target">
  {{ if eq .lAt2 1 }}
          One Ship Detected:<br>
  {{ else }}
          {{ .lAt2 }} Ships Detected:<br>
  {{ end }}

  {{ range .svAt2 }}
  {{ if eq $f.Fid .Controller }}
        {{ $dest := (index $svDest .) }}
        {{ $loc := $dest.Loc }}
        &bull; Your faction, size {{ .Size }}<br>
        {{ if eq $loc.String $center.String }}
        Destination: [ {{ $dest.Name }} ]<br>
        {{ else }}
        Destination: [ <a href="{{ command "recenter" }}/{{ index $loc 0 }}/{{ index $loc 1}}">{{ $dest.Name }}</a> ]<br>
        {{ end }}

        {{ if .Trail }} Passed Through: {{ range .Trail }}
        <a href="{{ command "recenter" }}/{{ index . 0 }}/{{ index . 1}}">({{ index . 0 }}, {{ index . 1 }})</a>
        {{ end }}<br> {{ end }}

  {{ else }}
        {{ index $fNames .Controller }}, size {{ .Size }}<br>
        {{ if .Trail }} Passed Through: {{ range .Trail }}
        <a href="{{ command "recenter" }}/{{ index . 0 }}/{{ index . 1}}">({{ index . 0 }}, {{ index . 1 }})</a>

        {{ end }}<br>{{ end }}
  {{ end }}
  {{ end }}

{{ end }}

{{ if .svTr2 }}
        <hr class="target">
{{ if eq .lTr2 1 }}
        One Ship Passage Detected:<br>
{{ else }}
        {{ .lTr2 }} Ship Passages Detected:<br>
{{ end }}

  {{ range .svTr2 }}
  {{ if eq $f.Fid .Controller }}
        {{ $dest := (index $svDest .) }}
        {{ $loc := index $svLoc . }}
        {{ $dloc := $dest.Loc }}
        &bull; Your faction, size {{ .Size }}<br>

      {{ if $loc.Valid }}
        {{ if $loc.IsCoord $center }}
          Current location: ({{ index $loc.Coord 0 }}, {{ index $loc.Coord 1 }})<br>
        {{ else }}
        Current location: <a href="{{ command "recenter" }}/{{ index $loc.Coord 0 }}/{{ index $loc.Coord 1 }}">({{ index $loc.Coord 0 }}, {{ index $loc.Coord 1 }})</a><br>
        {{ end }}
      {{ else }}
        Current location unknown<br>
      {{ end }}

        {{ if eq $dloc.String $center.String }}
        Destination: [ {{ $dest.Name }} ]<br>
        {{ else }}
        Destination: [ <a href="{{ command "recenter" }}/{{ index $dloc 0 }}/{{ index $dloc 1}}">{{ $dest.Name }}</a> ]<br>
        {{ end }}

        {{ if .Trail }} Passed Through: {{ range .Trail }}
        <a href="{{ command "recenter" }}/{{ index . 0 }}/{{ index . 1}}">({{ index . 0 }}, {{ index . 1 }})</a>
        {{ end }}<br> {{ end }}


  {{ else }}
        {{ $loc := index $svLoc . }}
        {{ index $fNames .Controller }}, size {{ .Size }}<br>

      {{ if $loc.Valid }}
        {{ if $loc.IsCoord $center }}
          Current location: ({{ index $loc.Coord 0 }}, {{ index $loc.Coord 1 }})<br>
        {{ else }}
        Current location: <a href="{{ command "recenter" }}/{{ index $loc.Coord 0 }}/{{ index $loc.Coord 1 }}">({{ index $loc.Coord 0 }}, {{ index $loc.Coord 1 }})</a><br>
        {{ end }}
      {{ else }}
        Current location unknown<br>
      {{ end }}

        {{ if .Trail }} Passed Through: {{ range .Trail }}
        <a href="{{ command "recenter" }}/{{ index . 0 }}/{{ index . 1}}">({{ index . 0 }}, {{ index . 1 }})</a>
        {{ end }}<br> {{ end }}

  {{ end }}
  {{ end }}

{{ end }}


</div>
<div class="leftframe">
        <div class="center"><b>Main Target:</b> {{ if .target1.Valid }}
        ({{ index .target1.Coord 0 }}, {{ index .target1.Coord 1 }})<br>
{{ if .cancenter1 }}
[ <a href="{{ command "recenter"}}/{{ index .target1.Coord 0 }}/{{ index .target1.Coord 1 }}">Center map here</a> ]<br>
{{ end }}
        </div>
        {{ if .tar1pv }}
        {{ $pl := .tar1pv }}
        {{ $other := .tar2pv }}
        {{ $yours := eq $pl.Controller $f.Fid }}
        <hr class="target">
        {{ $pl.Name }}<br>
        {{ if not $pl.Turn }} No planetary information available.<br> {{ else }}
        {{ if not $yours }}
        Hostile planet: {{ index $fNames $pl.Controller }}<br>
        Last seen on turn {{ $pl.Turn }}<br>
        Inhabitants: {{ $pl.Inhabitants }} &bull; Resources: {{ $pl.Resources }}<br>
        Ship parts: {{ $pl.Parts }}<br>


        {{ else }}
        {{ $avail := index .availMap $pl.Pid }}
        Your planet<br>
        Inhabitants: {{ $pl.Inhabitants }} &bull; Resources: {{ $pl.Resources }}<br>
        Ship parts: {{ $pl.Parts }} ({{ $avail }} available)<br>

        {{ if $other }} {{ if .t1t2ord }}
        <hr class="target">
        You have {{ $other.Name }} as your secondary target and are launching a ship sized {{ .t1t2ord.Size }} at it.  Change this launch order?<br>
        <form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setorder">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="hidden" name="source" value="{{ $pl.Pid }}">
        <input type="hidden" name="target" value="{{ $other.Pid }}">
        &bull; <input type="text" size=2 name="size">
        <input type="submit" value="Change size" class="noblock"> (0 to cancel)
        </form>
       
        {{ else if $avail }}
        <hr class="target">
        You have {{ $other.Name }} as your secondary target (distance {{ .tarDist }}) and have {{ $avail }} ship parts available to launch a ship at it.  <br>
        Order a launch? &bull;
        <form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setorder">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="hidden" name="source" value="{{ $pl.Pid }}">
        <input type="hidden" name="target" value="{{ $other.Pid }}">
        Ship size: <input type="text" size=2 name="size"><br>
        <input type="submit" value="Order launch at {{ $other.Name }}" class="noblock">
        </form>
        {{ end }} {{ end }}
        
        {{ if .t1ords }}
        <hr class="target">
        {{ if .t1t2ord }}Other {{end}}Planetary launch orders:<br>
        {{ range .t1ords }}
        {{ $pv := index $pidPV .Target }}
        {{ $loc := $pv.Loc }}
        {{ if ne $loc.String $center.String }}
        Ship size {{ .Size }} at [ <a href="{{ command "recenter" }}/{{ index $loc 0}}/{{ index $loc 1 }}">{{ $pv.Name }}</a> ] <br>
        {{ else }}
        Ship size {{ .Size }} at [ {{ $pv.Name }} ] <br>
        {{ end }}
        &bull;  <form action="" method="post" class="noblock">
                <input type="hidden" name="action" value="setorder">
                <input type="hidden" name="turn" value="{{ $g.Turn }}">
                <input type="hidden" name="source" value="{{ .Source }}">
                <input type="hidden" name="target" value="{{ .Target }}">
                <input type="text" size=2 name="size">
                <input type="submit" value="Change size" class="noblock"> (0 to cancel)
                </form>
       
        {{ end }}
        {{ else }}
        <hr class="target">
        You have no {{ if .t1t2ord }}other {{ end }}launch orders from {{ $pl.Name }}.<br>
        {{ end }}
        
        {{ end }} {{ end }}{{ end }}
        





        {{ else }} 
        None<br>
        </div>
        {{ end }}

{{ if .svAt1 }}
<hr class="target">
  {{ if eq .lAt1 1 }}
          One Ship Detected:<br>
  {{ else }}
          {{ .lAt1 }} Ships Detected:<br>
  {{ end }}

  {{ range .svAt1 }}
  {{ if eq $f.Fid .Controller }}
        {{ $dest := (index $svDest .) }}
        {{ $loc := $dest.Loc }}
        &bull; Your faction, size {{ .Size }}<br>
        {{ if eq $loc.String $center.String }}
        Destination: [ {{ $dest.Name }} ]<br>
        {{ else }}
        Destination: [ <a href="{{ command "recenter" }}/{{ index $loc 0 }}/{{ index $loc 1}}">{{ $dest.Name }}</a> ]<br>
        {{ end }}

        {{ if .Trail }} Passed Through: {{ range .Trail }}
        <a href="{{ command "recenter" }}/{{ index . 0 }}/{{ index . 1}}">({{ index . 0 }}, {{ index . 1 }})</a>
        {{ end }}<br> {{ end }}

  {{ else }}
        {{ index $fNames .Controller }}, size {{ .Size }}<br>
        {{ if .Trail }} Passed Through: {{ range .Trail }}
        <a href="{{ command "recenter" }}/{{ index . 0 }}/{{ index . 1}}">({{ index . 0 }}, {{ index . 1 }})</a>

        {{ end }}<br>{{ end }}
  {{ end }}
  {{ end }}

{{ end }}

{{ if .svTr1 }}
        <hr class="target">
{{ if eq .lTr1 1 }}
        One Ship Passage Detected:<br>
{{ else }}
        {{ .lTr1 }} Ship Passages Detected:<br>
{{ end }}

  {{ range .svTr1 }}
  {{ if eq $f.Fid .Controller }}
        {{ $dest := (index $svDest .) }}
        {{ $loc := index $svLoc . }}
        {{ $dloc := $dest.Loc }}
        &bull; Your faction, size {{ .Size }}<br>

      {{ if $loc.Valid }}
        {{ if $loc.IsCoord $center }}
          Current location: ({{ index $loc.Coord 0 }}, {{ index $loc.Coord 1 }})<br>
        {{ else }}
        Current location: <a href="{{ command "recenter" }}/{{ index $loc.Coord 0 }}/{{ index $loc.Coord 1 }}">({{ index $loc.Coord 0 }}, {{ index $loc.Coord 1 }})</a><br>
        {{ end }}
      {{ else }}
        Current location unknown<br>
      {{ end }}

        {{ if eq $dloc.String $center.String }}
        Destination: [ {{ $dest.Name }} ]<br>
        {{ else }}
        Destination: [ <a href="{{ command "recenter" }}/{{ index $dloc 0 }}/{{ index $dloc 1}}">{{ $dest.Name }}</a> ]<br>
        {{ end }}

        {{ if .Trail }} Passed Through: {{ range .Trail }}
        <a href="{{ command "recenter" }}/{{ index . 0 }}/{{ index . 1}}">({{ index . 0 }}, {{ index . 1 }})</a>
        {{ end }}<br> {{ end }}


  {{ else }}
        {{ $loc := index $svLoc . }}
        {{ index $fNames .Controller }}, size {{ .Size }}<br>

      {{ if $loc.Valid }}
        {{ if $loc.IsCoord $center }}
          Current location: ({{ index $loc.Coord 0 }}, {{ index $loc.Coord 1 }})<br>
        {{ else }}
        Current location: <a href="{{ command "recenter" }}/{{ index $loc.Coord 0 }}/{{ index $loc.Coord 1 }}">({{ index $loc.Coord 0 }}, {{ index $loc.Coord 1 }})</a><br>
        {{ end }}
      {{ else }}
        Current location unknown<br>
      {{ end }}

        {{ if .Trail }} Passed Through: {{ range .Trail }}
        <a href="{{ command "recenter" }}/{{ index . 0 }}/{{ index . 1}}">({{ index . 0 }}, {{ index . 1 }})</a>
        {{ end }}<br> {{ end }}

  {{ end }}
  {{ end }}

{{ end }}



</div>
<div class="clearer"></div>
<div class="targetcenter">
{{ if or .tarDist .canswap }} <hr class="target"> {{ end }}
{{ if .tarDist }}
        Distance between targets: {{ .tarDist }}<br>
{{ end }}
{{ if .canswap }}
<form action="" method="post" class="noblock">
        <input type="hidden" name="action" value="setmap">
        <input type="hidden" name="subtype" value="swap">
        <input type="hidden" name="turn" value="{{ $g.Turn }}">
        <input type="submit" value="Swap main/secondary targets" class="noblock">
</form>
{{ end }}
</div>
</div>

</div>
<script src="/static/js/overpower.js"></script>
{{ end }}
